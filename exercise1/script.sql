DROP TABLE IF EXISTS post_tags, comments, posts, tags, users CASCADE;

-- =====================
-- TABLAS
-- =====================
CREATE TABLE users (
  id          UUID PRIMARY KEY,
  username    VARCHAR(50) NOT NULL,
  password    TEXT NOT NULL,
  created_at  TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  modified_at TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  CONSTRAINT uq_users_username UNIQUE (username)
);

CREATE TABLE posts (
  id          UUID PRIMARY KEY,
  user_id     UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  title       VARCHAR(200) NOT NULL,
  content     TEXT NOT NULL,
  created_at  TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  modified_at TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL
);

CREATE INDEX idx_posts_user_id ON posts(user_id);

CREATE TABLE comments (
  id          UUID PRIMARY KEY,
  user_id     UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  post_id     UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  content     TEXT NOT NULL,
  created_at  TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  modified_at TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL
);

CREATE TABLE tags (
  id          UUID PRIMARY KEY,
  name        VARCHAR(60) NOT NULL,
  descripcion TEXT,
  created_at  TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  modified_at TIMESTAMP(6) WITHOUT TIME ZONE NOT NULL,
  CONSTRAINT uq_tags_name UNIQUE (name)
);

CREATE TABLE post_tags (
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  tag_id  UUID NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
  PRIMARY KEY (post_id, tag_id)
);

CREATE INDEX idx_post_tags_tag_id ON post_tags(tag_id);

-- =====================
-- USERS (10 registros)
-- =====================
INSERT INTO users VALUES
('00000000-0000-0000-0000-000000000001','ana','$hash','2025-08-01 10:00:00.111111','2025-08-01 10:00:00.111111'),
('00000000-0000-0000-0000-000000000002','bruno','$hash','2025-08-01 10:10:00.222222','2025-08-01 10:10:00.222222'),
('00000000-0000-0000-0000-000000000003','carla','$hash','2025-08-01 10:20:00.333333','2025-08-01 10:20:00.333333'),
('00000000-0000-0000-0000-000000000004','david','$hash','2025-08-01 10:30:00.444444','2025-08-01 10:30:00.444444'),
('00000000-0000-0000-0000-000000000005','elena','$hash','2025-08-01 10:40:00.555555','2025-08-01 10:40:00.555555'),
('00000000-0000-0000-0000-000000000006','felipe','$hash','2025-08-01 10:50:00.666666','2025-08-01 10:50:00.666666'),
('00000000-0000-0000-0000-000000000007','gabriela','$hash','2025-08-01 11:00:00.777777','2025-08-01 11:00:00.777777'),
('00000000-0000-0000-0000-000000000008','hector','$hash','2025-08-01 11:10:00.888888','2025-08-01 11:10:00.888888'),
('00000000-0000-0000-0000-000000000009','ivan','$hash','2025-08-01 11:20:00.999999','2025-08-01 11:20:00.999999'),
('00000000-0000-0000-0000-00000000000a','julia','$hash','2025-08-01 11:30:00.123456','2025-08-01 11:30:00.123456');

-- =====================
-- TAGS (10 registros)
-- =====================
INSERT INTO tags VALUES
('00000000-0000-0000-0000-000000000101','postgresql','Base de datos PostgreSQL','2025-08-02 08:00:00.111111','2025-08-02 08:00:00.111111'),
('00000000-0000-0000-0000-000000000102','sql','Consultas SQL','2025-08-02 08:10:00.222222','2025-08-02 08:10:00.222222'),
('00000000-0000-0000-0000-000000000103','javascript','Lenguaje de la web','2025-08-02 08:20:00.333333','2025-08-02 08:20:00.333333'),
('00000000-0000-0000-0000-000000000104','typescript','JS con tipado','2025-08-02 08:30:00.444444','2025-08-02 08:30:00.444444'),
('00000000-0000-0000-0000-000000000105','nodejs','Runtime para JS','2025-08-02 08:40:00.555555','2025-08-02 08:40:00.555555'),
('00000000-0000-0000-0000-000000000106','backend','Desarrollo servidor','2025-08-02 08:50:00.666666','2025-08-02 08:50:00.666666'),
('00000000-0000-0000-0000-000000000107','frontend','Desarrollo cliente','2025-08-02 09:00:00.777777','2025-08-02 09:00:00.777777'),
('00000000-0000-0000-0000-000000000108','devops','Integración y despliegue','2025-08-02 09:10:00.888888','2025-08-02 09:10:00.888888'),
('00000000-0000-0000-0000-000000000109','seguridad','Protección de sistemas','2025-08-02 09:20:00.999999','2025-08-02 09:20:00.999999'),
('00000000-0000-0000-0000-00000000010a','buenas-practicas','Código limpio','2025-08-02 09:30:00.123456','2025-08-02 09:30:00.123456');

-- =====================
-- POSTS (10 registros)
-- =====================
INSERT INTO posts VALUES
('00000000-0000-0000-0000-000000000201','00000000-0000-0000-0000-000000000001','Intro PostgreSQL','Contenido 1','2025-08-03 08:00:00.111111','2025-08-03 08:00:00.111111'),
('00000000-0000-0000-0000-000000000202','00000000-0000-0000-0000-000000000002','Optimización SQL','Contenido 2','2025-08-03 08:10:00.222222','2025-08-03 08:10:00.222222'),
('00000000-0000-0000-0000-000000000203','00000000-0000-0000-0000-000000000003','JS moderno','Contenido 3','2025-08-03 08:20:00.333333','2025-08-03 08:20:00.333333'),
('00000000-0000-0000-0000-000000000204','00000000-0000-0000-0000-000000000004','TS en backend','Contenido 4','2025-08-03 08:30:00.444444','2025-08-03 08:30:00.444444'),
('00000000-0000-0000-0000-000000000205','00000000-0000-0000-0000-000000000005','Node.js producción','Contenido 5','2025-08-03 08:40:00.555555','2025-08-03 08:40:00.555555'),
('00000000-0000-0000-0000-000000000206','00000000-0000-0000-0000-000000000006','Patrones arquitectura','Contenido 6','2025-08-03 08:50:00.666666','2025-08-03 08:50:00.666666'),
('00000000-0000-0000-0000-000000000207','00000000-0000-0000-0000-000000000007','Frontend buenas prácticas','Contenido 7','2025-08-03 09:00:00.777777','2025-08-03 09:00:00.777777'),
('00000000-0000-0000-0000-000000000208','00000000-0000-0000-0000-000000000008','CI/CD GitHub','Contenido 8','2025-08-03 09:10:00.888888','2025-08-03 09:10:00.888888'),
('00000000-0000-0000-0000-000000000209','00000000-0000-0000-0000-000000000009','Seguridad apps','Contenido 9','2025-08-03 09:20:00.999999','2025-08-03 09:20:00.999999'),
('00000000-0000-0000-0000-00000000020a','00000000-0000-0000-0000-00000000000a','Clean Code','Contenido 10','2025-08-03 09:30:00.123456','2025-08-03 09:30:00.123456');

-- =====================
-- COMMENTS (10 registros)
-- =====================
INSERT INTO comments VALUES
('00000000-0000-0000-0000-000000000301','00000000-0000-0000-0000-000000000002','00000000-0000-0000-0000-000000000201','Buen post','2025-08-04 10:00:00.111111','2025-08-04 10:00:00.111111'),
('00000000-0000-0000-0000-000000000302','00000000-0000-0000-0000-000000000003','00000000-0000-0000-0000-000000000202','Muy útil','2025-08-04 10:10:00.222222','2025-08-04 10:10:00.222222'),
('00000000-0000-0000-0000-000000000303','00000000-0000-0000-0000-000000000004','00000000-0000-0000-0000-000000000203','Excelente','2025-08-04 10:20:00.333333','2025-08-04 10:20:00.333333'),
('00000000-0000-0000-0000-000000000304','00000000-0000-0000-0000-000000000005','00000000-0000-0000-0000-000000000204','Interesante','2025-08-04 10:30:00.444444','2025-08-04 10:30:00.444444'),
('00000000-0000-0000-0000-000000000305','00000000-0000-0000-0000-000000000006','00000000-0000-0000-0000-000000000205','Buenísimo','2025-08-04 10:40:00.555555','2025-08-04 10:40:00.555555'),
('00000000-0000-0000-0000-000000000306','00000000-0000-0000-0000-000000000007','00000000-0000-0000-0000-000000000206','Perfecto','2025-08-04 10:50:00.666666','2025-08-04 10:50:00.666666'),
('00000000-0000-0000-0000-000000000307','00000000-0000-0000-0000-000000000008','00000000-0000-0000-0000-000000000207','Muy claro','2025-08-04 11:00:00.777777','2025-08-04 11:00:00.777777'),
('00000000-0000-0000-0000-000000000308','00000000-0000-0000-0000-000000000009','00000000-0000-0000-0000-000000000208','Aprendí mucho','2025-08-04 11:10:00.888888','2025-08-04 11:10:00.888888'),
('00000000-0000-0000-0000-000000000309','00000000-0000-0000-0000-00000000000a','00000000-0000-0000-0000-000000000209','Genial','2025-08-04 11:20:00.999999','2025-08-04 11:20:00.999999'),
('00000000-0000-0000-0000-00000000030a','00000000-0000-0000-0000-000000000001','00000000-0000-0000-0000-00000000020a','Gracias','2025-08-04 11:30:00.123456','2025-08-04 11:30:00.123456');

-- =====================
-- POST_TAGS (varios por post)
-- =====================
INSERT INTO post_tags VALUES
('00000000-0000-0000-0000-000000000201','00000000-0000-0000-0000-000000000101'),
('00000000-0000-0000-0000-000000000201','00000000-0000-0000-0000-000000000102'),
('00000000-0000-0000-0000-000000000202','00000000-0000-0000-0000-000000000102'),
('00000000-0000-0000-0000-000000000203','00000000-0000-0000-0000-000000000103'),
('00000000-0000-0000-0000-000000000204','00000000-0000-0000-0000-000000000104'),
('00000000-0000-0000-0000-000000000205','00000000-0000-0000-0000-000000000105'),
('00000000-0000-0000-0000-000000000205','00000000-0000-0000-0000-000000000106'),
('00000000-0000-0000-0000-000000000206','00000000-0000-0000-0000-000000000106'),
('00000000-0000-0000-0000-000000000207','00000000-0000-0000-0000-000000000107'),
('00000000-0000-0000-0000-000000000208','00000000-0000-0000-0000-000000000108'),
('00000000-0000-0000-0000-000000000209','00000000-0000-0000-0000-000000000109'),
('00000000-0000-0000-0000-00000000020a','00000000-0000-0000-0000-00000000010a'),
('00000000-0000-0000-0000-000000000204','00000000-0000-0000-0000-000000000105'),
('00000000-0000-0000-0000-000000000203','00000000-0000-0000-0000-000000000107'),
('00000000-0000-0000-0000-000000000202','00000000-0000-0000-0000-000000000101');
